<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS94 Signer Final</title>
    <style>
        body { font-family: -apple-system, sans-serif; background-color: #f2f2f7; text-align: center; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 20px; max-width: 400px; margin: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; color: #333; }
        .input-group { margin-bottom: 15px; text-align: right; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; font-size: 14px; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; background: #fafafa; }
        button { width: 100%; padding: 14px; background-color: #007aff; color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #status { margin-top: 15px; font-size: 13px; color: #666; white-space: pre-line; direction: ltr; }
    </style>
</head>
<body>

<div class="card">
    <h2>واژۆکەری کۆتایی - iOS94</h2>
    
    <div class="input-group">
        <label>1. فایلی IPA:</label>
        <input type="file" id="ipaFile" accept=".ipa">
    </div>
    <div class="input-group">
        <label>2. بڕوانامە (P12):</label>
        <input type="file" id="p12File" accept=".p12">
    </div>
    <div class="input-group">
        <label>3. تێپەڕەوشەی بڕوانامە (Password):</label>
        <input type="text" id="p12Pass" placeholder="١٢٣٤٥٦">
    </div>
    <div class="input-group">
        <label>4. فایلی MobileProvision:</label>
        <input type="file" id="provFile" accept=".mobileprovision">
    </div>
    <div class="input-group">
        <label>5. کۆدی تۆکێن (Token):</label>
        <input type="password" id="ghToken" placeholder="ghp_xxxxxxxxxxxx">
    </div>

    <button id="btn" onclick="startProcess()">ناردن و واژۆکردن</button>
    <p id="status"></p>
</div>

<script>
    const OWNER = 'ios94'; 
    const REPO = 'Sign';   

    async function startProcess() {
        const token = document.getElementById('ghToken').value.trim();
        const p12Pass = document.getElementById('p12Pass').value.trim();
        const btn = document.getElementById('btn');
        const status = document.getElementById('status');
        
        const ipaFile = document.getElementById('ipaFile').files[0];
        const p12File = document.getElementById('p12File').files[0];
        const provFile = document.getElementById('provFile').files[0];

        if (!token || !p12Pass) { alert("تکایە تۆکێن و پاسۆرد بنووسە"); return; }
        if (!ipaFile || !p12File || !provFile) { alert("تکایە هەموو فایلەکان هەڵبژێرە"); return; }

        btn.disabled = true;
        status.innerText = "⏳ خەریکە فایلەکان دەنێردرێت...";

        try {
            // Upload Pass as a file
            const passBlob = new Blob([p12Pass], { type: 'text/plain' });
            await uploadFile(passBlob, 'uploads/password.txt', token);

            await uploadFile(ipaFile, 'uploads/app.ipa', token);
            await uploadFile(p12File, 'uploads/cert.p12', token);
            await uploadFile(provFile, 'uploads/profile.mobileprovision', token);

            status.innerText = "✅ سەرکەوتوو بوو!\n ئێستا GitHub ڕەمزە ڕاستەکە بەکاردەهێنێت.\n دوای ١ خولەک سەیری بەشی Actions بکە.";
            status.style.color = "green";
        } catch (error) {
            status.innerText = "❌ هەڵە: " + error.message;
            status.style.color = "red";
            btn.disabled = false;
        }
    }

    function uploadFile(file, path, token) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async function() {
                const base64Content = reader.result.split(',')[1];
                let sha = null;
                try {
                    const check = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}`, {
                        headers: { 'Authorization': `token ${token}` }, cache: 'no-store'
                    });
                    if (check.ok) { const data = await check.json(); sha = data.sha; }
                } catch(e) {}

                const response = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: `Upload ${path}`, content: base64Content, sha: sha })
                });
                if (response.ok) resolve(); else reject(new Error("Upload Failed"));
            };
        });
    }
</script>
</body>
</html>
